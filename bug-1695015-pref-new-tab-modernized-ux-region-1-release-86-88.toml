[experiment]

segments = ["attributed", "non_attributed"]

enrollment_period = 7

reference_branch = "newtab-control"

## data sources

[data_sources]

## data source: AS session pings data
[data_sources.as_session_ping]
from_expression = "(SELECT client_id, user_prefs, experiments, date(submission_timestamp) as submission_date FROM  `moz-fx-data-shared-prod.activity_stream.sessions`)"
experiments_column_type = "native"

## Segments

[segments]

[segments.attributed]
select_expression = 'max(attr_source is not null)'
data_source = "npp"

[segments.non_attributed]
select_expression = 'max(attr_source is null)'
data_source = "npp"

[segments.data_sources.npp]
from_expression = """
    (SELECT
        DATE(submission_timestamp) AS submission_date,
        client_id,
        environment.settings.attribution.source AS attr_source
    FROM `moz-fx-data-shared-prod.telemetry.new_profile`
    WHERE environment.partner.distribution_id IS NULL
    AND coalesce(environment.settings.attribution.ua, '') != 'firefox'
    )
    """
window_start = -2
window_end = 0


## metrics

[metrics]
overall = ['days_of_use', 'search_count', 'organic_search_count', 'unenroll',
           'homepage_switch']

weekly = ['days_of_use', 'search_count', 'organic_search_count', 'unenroll',
           'homepage_switch']


[metrics.unenroll.statistics.binomial]



[metrics.homepage_switch]
select_expression = """COALESCE(MAX(
                CASE WHEN event = 'PAGE_TAKEOVER_DATA'
                THEN true ELSE false END), false)"""
data_source = 'activity_stream_events'
bigger_is_better = false

[metrics.homepage_switch.statistics.binomial]
